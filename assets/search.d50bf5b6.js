import"./tweet-component.088c1db2.js";import{U as _}from"./util.8203463a.js";q();async function q(){const u="https://fabxmporizzqflnftavs.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZhYnhtcG9yaXp6cWZsbmZ0YXZzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjIyNDQ5MTIsImV4cCI6MjAzNzgyMDkxMn0.UIEJiUNkLsW28tBHmG-RQDW-I5JNlJLt62CSk9D_qG8",w=window.supabase.createClient(u,s),d=new URLSearchParams(window.location.search),o=d.get("username"),y=d.get("sortByDate");if(o==null){document.querySelector("#title").innerHTML="Error: missing username query param";return}const b=await(await fetch("./users.json")).json(),{query_url:g,name:I,subtitle:$,avatar:M}=b[o],S=g,n=new _;n.username=o,n.name=I,n.avatar=M,document.querySelector("#title").innerHTML=n.username,document.querySelector(".subtitle").innerHTML=$;const l=document.querySelector("#clusterThreads");document.querySelector(".search-box").addEventListener("keydown",async function(a){if(a.key==="Enter"&&!a.shiftKey){document.querySelector("#instructions").style.display="none",l.innerHTML="<h3>Searching embedding space...</h3>",a.preventDefault();const m=this.value;let t=await(await fetch(S,{method:"POST",body:JSON.stringify({searchTerm:m})})).json();console.log(t),o=="defenderofbasic"&&(console.log(t.matches),t.matches=t.matches.map(e=>({id:e.metadata.id,score:e.score}))),l.innerHTML=`<h3>Fetching ${t.matches.length} tweets...</h3>`;const J=(await w.schema("public").from("tweets").select("*").in("tweet_id",t.matches.map(e=>e.id))).data,p={};J.forEach(e=>{p[e.tweet_id]=e});let f="",r=[];for(let e=0;e<t.matches.length;e++){const i=t.matches[e],L=p[i.id];r.push({tweet:L,score:i.score})}y&&(console.log("sorting by date"),r=r.sort((e,i)=>new Date(e.tweet.created_at)-new Date(i.tweet.created_at))),console.log(r),r.forEach(e=>{f+=T(e.tweet,e.score)}),l.innerHTML=f}});function T(a,m){let c="";c+=`<p>similarity score: ${m}</p>`;const t=new Date(a.created_at),h=`https://x.com/${n.username}/status/${a.tweet_id}`;return c+=`<tweet-component
                            avatar="${n.avatar}"
                            name="${n.name}"
                            username="${n.username}"
                            timestamp="${t}"
                            likes="${a.favorite_count}"
                            retweets="${a.retweet_count}"
                            url="${h}"
                        >
                        ${D(a.full_text)}
                        </tweet-component>
                    `,c}}function D(u){let s=u.replace(/"/g,"&quot;");return s=s.replace(/'/g,"&#39;"),s=s.replace(/\n/g,"<br>"),s=s.replace(/(https?:\/\/[^\s]+)/g,'<a href="$1" target="_blank">$1</a>'),s}
